<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Ranking</title>
<meta name="language" content="en" />
<meta name="author" content="Alexei Fedotov" />
<!--<link rel="stylesheet" href="../include/root.css" type="text/css" />
<script type="text/javascript" src="../include/root.js"></script>-->
<script src="http://www.google.com/jsapi?key=ABQIAAAAFaJe69YXUkm0QwCwCR8_URS-J-3EKMotstQWCYD04pqWnjjCWhQXOE8lkByUEet-SNNNXuIauYsjzw" type="text/javascript"></script>
<script language="Javascript" type="text/javascript">
//<![CDATA[

google.load("search", "1")

function Glob(urls, max) {
    this.urls = urls
    this.max = max
}

Glob.prototype.rank = function(searchControl, searcher) {
    m_str = '- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -'
    with (this) {
        var res = 0
        if (searcher.cursor) res = searcher.cursor.estimatedResultCount
        document.getElementById('td' + max).innerHTML = m_str.substr(0, Math.round(Math.log(res * 0.1 + 1) * 10)) + ' ' + res
        if (max > 0) { // Execute an inital search
            searchControl.execute(urls[--max])
        } else {
            document.data.dest.value = document.getElementById("tablecontrol").innerHTML
        }
    }
}

function rank() {
    // Create a search control
    var searchControl = new google.search.SearchControl()
    searchControl.addSearcher(new google.search.WebSearch())

    // Tell the searcher to draw itself and tell it where to attach
    searchControl.draw(document.getElementById("searchcontrol"))

    with (document.data) {

        var re = /(<a[^>]*href\s*=(['"]?)(https?:\/\/)([^'" \t\n\/]*)([^'" \t\n\r]*)\2[^>]*>[^<]*<\/a>)/g
        var result, hash = {}

        var lines = '', i
        for (i = 0; (result = re.exec(source.value)) != null; i++) {
            var url = result[3] + result[4]
            hash[url] = result[0]
        }

        var lines = ''
        var max = 0, urls = {}
        for (url in hash) {
            urls[max] = 'link:' + url
            lines += '<tr><td align="right">' + hash[url] + '</td><td id="td' + max + '"></td></tr>'
            max++;
        }
        document.getElementById("tablecontrol").innerHTML = '<table border="0">' + lines + '</table>'
    }

    var glob = new Glob(urls, --max)
    searchControl.setSearchCompleteCallback(glob, Glob.prototype.rank)
    searchControl.execute(urls[max])
}


//]]>
</script>
</head>
  <body><center>
    <h2>Ranking a list</h2>
    <form name="data" onsubmit="return false;">
      <textarea name="source" rows="2" cols="40"></textarea><br/>
      <textarea name="dest" rows="2" cols="40"></textarea><br/>
      <input type="submit" value="Rank URL list" onclick="rank()" />
    </form>
    <div id="searchcontrol">Search loading...</div>
    </center>
    <div id="tablecontrol">Table loading...</div>
  </body>
</html>

